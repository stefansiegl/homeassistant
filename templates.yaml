- sensor:
    - name: Grunbeck Gesamtwassermenge
      unique_id: grunbeck_gesamtwassermenge
      unit_of_measurement: "L"
      state_class: total_increasing
      device_class: water
      state: >-
        {% set wwh = states("sensor.grunbeck_weichwasser_harte")|float(0) %}
        {% set rwh = states("sensor.grunbeck_rohwasser_harte")|float(0) %}
        {% set wwm = states("sensor.grunbeck_weichwassermenge")|float(0) %}
        {% if (is_number(wwh) and (wwh > 1)) and (is_number(rwh) and (rwh > 1)) and (is_number(wwm) and (wwm > 1)) %}
          {% set gwn = ((wwh*wwm)/(rwh-wwh)+wwm)|round(4) |float(unavailable) %}
        {% endif %}
        {% if is_number(gwn) %}
          {{ gwn }}
        {% endif %}
